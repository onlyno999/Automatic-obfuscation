const a0Z=a0b;function a0a(){const an=['split','HTTP\x20proxy\x20refused:\x20','toLowerCase','pop','host','2599916dHPCGq','Exhausted.','send','protocol','opened','address','large','3725520JPjljd','shift','tot','releaseLock','value','min','free','padEnd','type','enableLarge','4856360nscHRP','direct','port','match','adaptive','70VwQLix','socks5','map','45189yofXvD','substring','SOCKS5\x20connect\x20failed','6TIcZLh','://','read','Invalid\x20address\x20type.','values','splice','close','Host:\x20','5706999oVCspO','decode','cfg','startsWith','encode','alloc','push','http','bee9ac63-20ea-4b0b-876a-09831e5f755a','readyState','floor','toString','reset','hostname','Error.','User-Agent:\x20Mozilla/5.0\x20(Windows\x20NT\x2010.0;\x20Win64;\x20x64)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/129.0.0.0\x20Safari/537.36\x0d\x0a','SOCKS5\x20auth\x20failed','password','lastIndexOf','big','websocket','30922PpyIyT','getWriter','buffered','Poor\x20network.','write','buf','now','Stall.','addressType','addEventListener','length','replace','\x20HTTP/1.1\x0d\x0a','Invalid\x20proxy\x20config','includes','message','pool','http=','headers','username','http:','win','getReader','set','CONNECT\x20','Max\x20reconnect.','url','test','max','data','$1-$2-$3-$4-$5','readable','random','from','get','HTTP\x20proxy\x20closed\x20unexpectedly','3421194tZNmej','ptr','byteLength','join','slice','cnt','buffer','HTTP\x20proxy\x20response\x20too\x20large','writable'];a0a=function(){return an;};return a0a();}(function(a,b){const Y=a0b,c=a();while(!![]){try{const d=parseInt(Y(0xde))/0x1+parseInt(Y(0xbb))/0x2*(-parseInt(Y(0xbe))/0x3)+parseInt(Y(0x110))/0x4+parseInt(Y(0x117))/0x5+-parseInt(Y(0xc1))/0x6*(parseInt(Y(0x102))/0x7)+parseInt(Y(0x121))/0x8+-parseInt(Y(0xc9))/0x9;if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a0a,0x5d810));import{connect}from'cloudflare:sockets';let a0c=a0Z(0xd1);const a0d=0x2*0x400*0x400,a0e=0x3a98,a0f=0x1f40,a0g=0xc,a0h=0x18,a0i=(b,c)=>Array[a0Z(0xff)](b[a0Z(0x106)](c,c+0x10))[a0Z(0xbd)](d=>d[a0Z(0xd4)](0x10)['padStart'](0x2,'0'))[a0Z(0x105)]('')[a0Z(0xe9)](/(.{8})(.{4})(.{4})(.{4})(.{12})/,a0Z(0xfc));export default{async 'fetch'(a,b){const a0=a0Z,c=new URL(a[a0(0xf8)]);if(a[a0(0xf0)][a0(0x100)]('Upgrade')?.['toLowerCase']()!==a0(0xdd))return new Response('OK',{'status':0xc8});const {proxyIP:d,socks5:e,enableSocks:f,globalProxy:g}=a0o(c['pathname']),{0x0:h,0x1:i}=new WebSocketPair();return i['accept'](),a0q(i,d,e,f,g),new Response(null,{'status':0x65,'webSocket':h});}};const a0j=a=>{const a1=a0Z,c=0x12+a[0x11]+0x1,d=a[c]<<0x8|a[c+0x1],e=a[c+0x2];let f=c+0x3,g,i;switch(e){case 0x1:i=0x4,g=a[a1(0x106)](f,f+i)[a1(0x105)]('.');break;case 0x2:i=a[f++],g=new TextDecoder()[a1(0xca)](a[a1(0x106)](f,f+i));break;case 0x3:i=0x10,g='['+Array[a1(0xff)]({'length':0x8},(j,k)=>(a[f+k*0x2]<<0x8|a[f+k*0x2+0x1])['toString'](0x10))[a1(0x105)](':')+']';break;default:throw new Error(a1(0xc4));}return{'host':g,'port':d,'payload':a[a1(0x106)](f+i),'addressType':e};},a0k=a=>{const a2=a0Z;if(a[a2(0xcc)]('[')){const d=a['match'](/^\[(.+?)\]:(\d+)$/);if(d)return[d[0x1],Number(d[0x2])];return[a[a2(0x106)](0x1,-0x1),0x1bb];}const [b,c=0x1bb]=a[a2(0x10b)](':');return[b,Number(c)];},a0l=a=>{const a3=a0Z;let b,c,d,e;if(a[a3(0xec)](a3(0xc2))&&!a[a3(0xb9)](/^(socks5?|https?):\/\//i)){const f=new URL(a);d=f[a3(0xd6)],e=f[a3(0xb8)]||(f[a3(0x113)]===a3(0xf2)?0x50:0x438);const g=f[a3(0xf1)]||f[a3(0xda)]?f[a3(0xf1)]+':'+f[a3(0xda)]:f[a3(0xf1)];if(g&&g['includes'](':'))[b,c]=g[a3(0x10b)](':');else{if(g)try{const i=atob(g[a3(0xe9)](/%3D/g,'=')['padEnd'](g[a3(0xe8)]+(0x4-g['length']%0x4)%0x4,'=')),j=i[a3(0x10b)](':');if(j[a3(0xe8)]===0x2)[b,c]=j;}catch{}}}else{let k='',l=a;const m=a[a3(0xdb)]('@');m!==-0x1&&(k=a['substring'](0x0,m),l=a[a3(0xbf)](m+0x1));if(k&&!k[a3(0xec)](':'))try{const q=atob(k[a3(0xe9)](/%3D/g,'=')[a3(0x11e)](k[a3(0xe8)]+(0x4-k['length']%0x4)%0x4,'=')),r=q[a3(0x10b)](':');if(r[a3(0xe8)]===0x2)[b,c]=r;}catch{}if(!b&&k&&k[a3(0xec)](':'))[b,c]=k['split'](':');const [n,o]=a0k(l);d=n,e=o||(a[a3(0xec)](a3(0xef))?0x50:0x438);}if(!d||isNaN(e))throw new Error(a3(0xeb));return{'username':b,'password':c,'hostname':d,'port':e};};async function a0m(a,b,c,d){const a4=a0Z,{username:e,password:f,hostname:g,port:h}=d,i=connect({'hostname':g,'port':h}),j=i[a4(0x10a)][a4(0xdf)]();await j[a4(0xe2)](new Uint8Array([0x5,e?0x2:0x1,0x0,e?0x2:0x0]));const k=i['readable']['getReader'](),l=new TextEncoder();let m=(await k['read']())['value'];if(m[0x1]===0x2){const o=new Uint8Array([0x1,e['length'],...l[a4(0xcd)](e),f[a4(0xe8)],...l[a4(0xcd)](f)]);await j[a4(0xe2)](o),m=(await k[a4(0xc3)]())[a4(0x11b)];if(m[0x1]!==0x0)throw new Error(a4(0xd9));}let n;if(a===0x1)n=new Uint8Array([0x1,...b[a4(0x10b)]('.')[a4(0xbd)](Number)]);else{if(a===0x2)n=new Uint8Array([0x3,b[a4(0xe8)],...l[a4(0xcd)](b)]);else{if(a===0x3){const p=b[a4(0x106)](0x1,-0x1)['split'](':')['flatMap'](q=>[parseInt(q[a4(0x106)](0x0,0x2),0x10),parseInt(q[a4(0x106)](0x2,0x4),0x10)]);n=new Uint8Array([0x4,...p]);}}}await j[a4(0xe2)](new Uint8Array([0x5,0x1,0x0,...n,c>>0x8&0xff,c&0xff])),m=(await k[a4(0xc3)]())['value'];if(m[0x1]!==0x0)throw new Error(a4(0xc0));return j[a4(0x11a)](),k['releaseLock'](),i;}function a0b(a,b){a=a-0xb8;const c=a0a();let d=c[a];return d;}async function a0n(a,b,c,d){const a5=a0Z,{username:e,password:f,hostname:g,port:h}=d,i=connect({'hostname':g,'port':h});let j=a5(0xf6)+b+':'+c+a5(0xea)+(a5(0xc8)+b+':'+c+'\x0d\x0a');e&&f&&(j+='Proxy-Authorization:\x20Basic\x20'+btoa(e+':'+f)+'\x0d\x0a');j+=a5(0xd8)+'Connection:\x20keep-alive\x0d\x0a\x0d\x0a';const k=i[a5(0x10a)]['getWriter']();await k[a5(0xe2)](new TextEncoder()[a5(0xcd)](j)),k['releaseLock']();const l=i[a5(0xfd)]['getReader']();let m=new Uint8Array(0x0);while(!![]){const {value:n,done:o}=await l[a5(0xc3)]();if(o)throw new Error(a5(0x101));const p=new Uint8Array(m[a5(0xe8)]+n[a5(0xe8)]);p[a5(0xf5)](m),p[a5(0xf5)](n,m[a5(0xe8)]),m=p;if(m[a5(0xe8)]>0x10000)throw new Error(a5(0x109));const q=new TextDecoder()[a5(0xca)](m);if(q['includes']('\x0d\x0a\x0d\x0a')){if(/^HTTP\/1\.[01] 2/i[a5(0xf9)](q[a5(0x10b)]('\x0d\x0a')[0x0]))return l[a5(0x11a)](),i;throw new Error(a5(0x10c)+q['split']('\x0d\x0a')[0x0]);}}}function a0o(a){const a6=a0Z;let b=null,c=null,d=null,e=null;const f=a[a6(0xb9)](/(socks5?|https?):\/\/([^/#?]+)/i);if(f){const i=a0l(f[0x2]);return e={'type':f[0x1]['toLowerCase']()[a6(0xec)]('5')||f[0x1]==='socks'?a6(0xbc):'http','cfg':i},{'proxyIP':b,'socks5':c,'enableSocks':d,'globalProxy':e};}const g=a[a6(0xb9)](/(?:^|\/)(?:proxy)?ip[=\/]([^?#]+)/i);if(g){const j=g[0x1],[k,l=0x1bb]=a0k(j);b={'address':k[a6(0xec)]('[')?k[a6(0x106)](0x1,-0x1):k,'port':+l};}const h=a['match'](/(?:^|\/)(socks5?|s5|http)[=\/]([^/#?]+)/i);if(h){const m=h[0x2];c=a0l(m),d=h[0x1][a6(0x10d)]()[a6(0xec)](a6(0xd0))?'http':'socks5';}return{'proxyIP':b,'socks5':c,'enableSocks':d,'globalProxy':e};}class a0p{constructor(){const a7=a0Z;this[a7(0xe3)]=new ArrayBuffer(0x4000),this[a7(0x103)]=0x0,this[a7(0xee)]=[],this['max']=0x8,this[a7(0x116)]=![];}[a0Z(0xce)]=a=>{const a8=a0Z;if(a<=0x1000&&a<=0x4000-this['ptr']){const c=new Uint8Array(this[a8(0xe3)],this[a8(0x103)],a);return this[a8(0x103)]+=a,c;}const b=this[a8(0xee)][a8(0x10e)]();if(b&&b[a8(0x104)]>=a)return new Uint8Array(b[a8(0x108)],0x0,a);return new Uint8Array(a);};['free']=a=>{const a9=a0Z;if(a[a9(0x108)]===this[a9(0xe3)]){this['ptr']=Math[a9(0xfa)](0x0,this[a9(0x103)]-a[a9(0xe8)]);return;}if(this[a9(0xee)][a9(0xe8)]<this[a9(0xfa)]&&a[a9(0x104)]>=0x400)this[a9(0xee)][a9(0xcf)](a);};[a0Z(0x120)]=()=>{this['large']=!![];};[a0Z(0xd5)]=()=>{const aa=a0Z;this[aa(0x103)]=0x0,this[aa(0xee)][aa(0xe8)]=0x0,this[aa(0x116)]=![];};}const a0q=(a,b,c,d,e)=>{const ab=a0Z,f=new a0p();let g,h,i,j,k=!![],l=0x0,m=0x0,n=0x0,o=Date[ab(0xe4)](),p=![],q=![];const s={},t=[];let u=0x0,v=0x1,x=Date[ab(0xe4)](),y=0x0,z=0x0,A=0x0,B={'tot':0x0,'cnt':0x0,'big':0x0,'win':0x0,'ts':Date[ab(0xe4)]()},C=ab(0xba),D=0x0,E=[];const F=N=>{const ac=ab;B[ac(0x119)]+=N,B['cnt']++;if(N>0x2000)B[ac(0xdc)]++;D=D*0.9+N*0.1;const O=Date[ac(0xe4)]();if(O-B['ts']>0x3e8){const P=B[ac(0xf3)];E[ac(0xcf)](P);if(E[ac(0xe8)]>0x5)E[ac(0x118)]();B[ac(0xf3)]=N,B['ts']=O;const Q=E['reduce']((R,S)=>R+S,0x0)/E[ac(0xe8)];if(B[ac(0x107)]>=0x14){if(Q<0x800000||D<0x1000)C!==ac(0xe0)&&(C=ac(0xe0),f[ac(0x120)]());else{if(Q>0x1000000&&D>0x3000){if(C!==ac(0x122))C=ac(0x122);}else{if(C!==ac(0xba))C='adaptive';}}}}else B['win']+=N;},G=async()=>{const ae=ab;if(q)return;q=!![];let N=[],O=0x0,P=null;const Q=()=>{const ad=a0b;if(!O)return;const R=new Uint8Array(O);let S=0x0;for(const T of N){R['set'](T,S),S+=T[ad(0xe8)];}if(a[ad(0xd2)]===0x1)a[ad(0x112)](R);N=[],O=0x0,P&&(clearTimeout(P),P=null);};try{while(!![]){if(u>a0d){await new Promise(T=>setTimeout(T,0x64));continue;}const {done:R,value:S}=await i['read']();if(S?.[ae(0xe8)]){l+=S[ae(0xe8)],o=Date[ae(0xe4)](),m=0x0,F(S[ae(0xe8)]);const T=Date['now']();if(T-x>0x1388){const U=T-x,V=l-y,W=V/U;if(W>0x1f4)v=Math[ae(0x11c)](0x1,v+0.05);else{if(W<0x32)v=Math[ae(0xfa)](0.1,v-0.05);}x=T,y=l;}if(C===ae(0xe0)){if(S[ae(0xe8)]<0x4000){N[ae(0xcf)](S),O+=S[ae(0xe8)];if(O>=0x10000)Q();else{if(!P)P=setTimeout(Q,D>0x2000?0x8:0x19);}}else{Q();if(a['readyState']===0x1)a[ae(0x112)](S);}}else{if(C===ae(0x122)){Q();if(a[ae(0xd2)]===0x1)a[ae(0x112)](S);}else{if(C===ae(0xba)){if(S['length']<0x2000){N[ae(0xcf)](S),O+=S['length'];if(O>=0xc000)Q();else{if(!P)P=setTimeout(Q,0xc);}}else{Q();if(a[ae(0xd2)]===0x1)a[ae(0x112)](S);}}}}}if(R){Q(),q=![],J();break;}}}catch(X){Q();if(P)clearTimeout(P);q=![],A++,J();}},H=async(N,O,P)=>{const af=ab;if(e){if(e[af(0x11f)]===af(0xbc))return await a0m(P,N,O,e[af(0xcb)]);if(e[af(0x11f)]===af(0xd0))return await a0n(P,N,O,e[af(0xcb)]);}try{const Q=connect({'hostname':N,'port':O});if(Q[af(0x114)])await Q[af(0x114)];return Q;}catch(R){if(!c&&!b)throw R;if(c)try{const S=d==='http'?await a0n(P,N,O,c):await a0m(P,N,O,c);if(S['opened'])await S['opened'];return S;}catch{}if(b)try{const T=connect({'hostname':b[af(0x115)],'port':b[af(0xb8)]});if(T['opened'])await T[af(0x114)];return T;}catch{}throw R;}},I=async()=>{const ag=ab;try{g=await H(j[ag(0x10f)],j[ag(0xb8)],j[ag(0xe6)]);if(g[ag(0x114)])await g[ag(0x114)];h=g[ag(0x10a)][ag(0xdf)](),i=g['readable'][ag(0xf4)]();const N=t[ag(0xc6)](0x0,0xa);for(const O of N){await h[ag(0xe2)](O),u-=O[ag(0xe8)],f[ag(0x11d)](O);}p=![],n=0x0,v=Math[ag(0x11c)](0x1,v+0.15),z++,o=Date[ag(0xe4)](),G();}catch(P){p=![],A++,v=Math['max'](0.1,v-0.2),J();}},J=async()=>{const ah=ab;if(!j||a['readyState']!==0x1){M(),a[ah(0xc7)](0x3f3,'Invalid.');return;}if(n>=a0h){M(),a[ah(0xc7)](0x3f3,ah(0xf7));return;}if(v<0.3&&n>0x5&&Math[ah(0xfe)]()>0.6){M(),a['close'](0x3f3,ah(0xe1));return;}if(p)return;n++;let N=Math[ah(0x11c)](0x32*Math['pow'](1.5,n-0x1),0xbb8);N*=1.5-v*0.5,N+=(Math[ah(0xfe)]()-0.5)*N*0.2,N=Math[ah(0xfa)](0x32,Math[ah(0xd3)](N));try{L();if(u>a0d*0x2)while(u>a0d&&t[ah(0xe8)]>0x5){const P=t[ah(0x118)]();u-=P['length'],f[ah(0x11d)](P);}await new Promise(Q=>setTimeout(Q,N)),p=!![],g=connect({'hostname':j['host'],'port':j[ah(0xb8)]}),await g[ah(0x114)],h=g[ah(0x10a)][ah(0xdf)](),i=g[ah(0xfd)][ah(0xf4)]();const O=t[ah(0xc6)](0x0,0xa);for(const Q of O){await h['write'](Q),u-=Q[ah(0xe8)],f['free'](Q);}p=![],n=0x0,v=Math[ah(0x11c)](0x1,v+0.15),z++,m=0x0,o=Date[ah(0xe4)](),G();}catch(R){p=![],A++,v=Math[ah(0xfa)](0.1,v-0.2);if(n<a0h&&a[ah(0xd2)]===0x1)setTimeout(J,0x1f4);else M(),a['close'](0x3f3,ah(0x111));}},K=()=>{s['ka']=setInterval(async()=>{const ai=a0b;if(!p&&h&&Date[ai(0xe4)]()-o>a0e)try{await h['write'](new Uint8Array(0x0)),o=Date[ai(0xe4)]();}catch(N){J();}},a0e/0x3),s['hc']=setInterval(()=>{const aj=a0b;!p&&B[aj(0x119)]>0x0&&Date['now']()-o>a0f&&(m++,m>=a0g&&(n<a0h?(m=0x0,J()):(M(),a['close'](0x3f3,aj(0xe5)))));},a0f/0x2);},L=()=>{const ak=ab;q=![];try{h?.[ak(0x11a)](),i?.[ak(0x11a)](),g?.['close']();}catch{}},M=()=>{const al=ab;Object[al(0xc5)](s)['forEach'](clearInterval),L();while(t[al(0xe8)])f[al(0x11d)](t['shift']());u=0x0,B={'tot':0x0,'cnt':0x0,'big':0x0,'win':0x0,'ts':Date[al(0xe4)]()},C='adaptive',D=0x0,E=[],f[al(0xd5)]();if(a['readyState']===0x1)a[al(0xc7)](code,reason);};a['addEventListener'](ab(0xed),async N=>{const am=ab;try{if(k){k=![];const O=new Uint8Array(N[am(0xfb)]);if(a0i(O,0x1)!==a0c)throw new Error('Auth\x20failed');const {host:P,port:Q,payload:R,addressType:S}=a0j(O);j={'host':P,'port':Q,'addressType':S},a[am(0x112)](new Uint8Array([O[0x0],0x0])),p=!![];if(R[am(0xe8)]){const T=f[am(0xce)](R[am(0xe8)]);T[am(0xf5)](R),t['push'](T),u+=T[am(0xe8)];}K(),I();}else{o=Date[am(0xe4)]();if(p||!h){const U=f[am(0xce)](N[am(0xfb)][am(0x104)]);U[am(0xf5)](new Uint8Array(N[am(0xfb)])),t[am(0xcf)](U),u+=U[am(0xe8)];}else await h[am(0xe2)](N[am(0xfb)]);}}catch(V){M(),a[am(0xc7)](0x3ee,am(0xd7));}}),a[ab(0xe7)](ab(0xc7),M),a[ab(0xe7)]('error',M);};