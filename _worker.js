const a0O=a0b;(function(a,b){const N=a0b,c=a();while(!![]){try{const d=-parseInt(N(0x198))/0x1+parseInt(N(0x117))/0x2*(parseInt(N(0x130))/0x3)+parseInt(N(0x139))/0x4+-parseInt(N(0x11a))/0x5*(-parseInt(N(0x155))/0x6)+-parseInt(N(0x17a))/0x7+parseInt(N(0x196))/0x8+-parseInt(N(0x18f))/0x9*(parseInt(N(0x180))/0xa);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a0a,0x7dc59));import{connect}from'cloudflare:sockets';const a0c='vl',a0d=a0O(0x191),a0e=a0O(0x13b);let a0f=a0O(0x13c),a0g=a0O(0x11e),a0h=![],a0i='',a0j=![],a0k=a0O(0x19f),a0l=[a0O(0x150)],a0m=[''],a0n='SOCKS5版',a0o=!![],a0p=!![],a0q='',a0r='',a0s=[],a0t=0x0;const a0u=0x5*0x3c*0x3e8,a0v=0x1388,a0w=['https://dns.google/dns-query',a0O(0x184),'https://1.1.1.1/dns-query',a0O(0x16e)],a0x='https://cf-worker-dir-bke.pages.dev/';async function a0y(){const P=a0O;try{const a=await fetch(a0x,{'cf':{'cacheEverything':!![]}});return new Response(a[P(0x147)],a);}catch{return new Response(P(0x15c),{'status':0xc8,'headers':{'Content-Type':P(0x13a)}});}}const a0z=(a,b,c)=>{const Q=a0O,d=import.meta?.['env']?.[a]??c?.[a];if(d===undefined||d===null||d==='')return b;if(typeof d===Q(0x131)){const e=d['trim']();if(e==='true')return!![];if(e===Q(0x152))return![];if(e[Q(0x168)]('\x0a'))return e[Q(0x12e)]('\x0a')[Q(0x19b)](f=>f['trim']())[Q(0x124)](Boolean);if(!isNaN(e)&&e!=='')return Number(e);return e;}return d;};async function a0A(){const R=a0O;if(!a0r){console[R(0x15b)](R(0x14e));return;}const a=Date[R(0x15f)]();if(a-a0t<a0u&&a0s[R(0x133)]>0x0)return;console[R(0x15b)](R(0x16f));try{const b=await fetch(a0r);if(!b['ok'])throw new Error('加载探子名单失败:\x20'+b['statusText']+R(0x12a)+b[R(0x197)]+')');const c=await b[R(0x11c)](),d=c[R(0x12e)]('\x0a')['map'](f=>f['trim']())[R(0x124)](f=>f&&!f[R(0x19c)]('#'));d[R(0x133)]>0x0?(a0s=d,a0t=a,console['log'](R(0x129)+a0s[R(0x133)]+'\x20个探子窝点。')):console[R(0x170)](R(0x181));}catch(f){console['error'](R(0x15a)+f[R(0x159)]+R(0x18b));}}export default{async 'fetch'(a,b){const S=a0O;a0f=a0z('ID',a0f,b),a0g=a0z('UUID',a0g,b),a0l=a0z('IP',a0l,b),a0m=a0z('TXT',a0m,b),a0i=a0z('私钥',a0i,b),a0j=a0z('隐藏',a0j,b),a0h=a0z('私钥开关',a0h,b),a0k=a0z(S(0x16d),a0k,b),a0n=a0z('我的节点名字',a0n,b),a0o=a0z(S(0x14f),a0o,b),a0p=a0z(S(0x173),a0p,b),a0q=a0z(S(0x141),a0q,b),a0r=a0z(S(0x119),a0r,b),await a0A();const c=a[S(0x161)]['get']('Upgrade'),d=new URL(a[S(0x153)]);if(!c||c!==S(0x18e)){if(a0m){const f=Array[S(0x13f)](a0m)?a0m:[a0m],g=[];for(const h of f){try{const i=await fetch(h),j=await i['text'](),l=j['split']('\x0a')[S(0x19b)](m=>m[S(0x195)]())[S(0x124)](m=>m);g['push'](...l);}catch(m){console[S(0x170)]('从名单联络据点失败:\x20'+h,m);}}if(g[S(0x133)]>0x0)a0l=g;}switch(d['pathname']){case'/':return a0y();case'/'+a0f:{const n=a0L(a0f,a[S(0x161)]['get']('Host'));return new Response(n,{'status':0xc8,'headers':{'Content-Type':S(0x128)}});}case'/'+a0f+'/'+a0c+a0d:{if(a0j)return new Response(a0k,{'status':0xc8,'headers':{'Content-Type':S(0x128)}});else{const o=a0M(a[S(0x161)][S(0x176)](S(0x188)));return new Response(o,{'status':0xc8,'headers':{'Content-Type':'text/plain;charset=utf-8'}});}}default:return new Response(S(0x193),{'status':0xc8});}}else{if(a0h){const r=a[S(0x161)][S(0x176)](S(0x192));if(r!==a0i)return new Response('信物不对，杀！',{'status':0x193});}const p=a[S(0x161)][S(0x176)](S(0x120)),q=a0C(p);if(!a0h&&a0H(new Uint8Array(q[S(0x164)](0x1,0x11)))!==a0g)return new Response('暗号不对',{'status':0x193});try{const {tcpSocket:s,初始数据:t}=await a0D(q);return await a0B(a,s,t);}catch(u){return console[S(0x143)]('匪帮暗号解析或接头失败:',u),new Response(S(0x17e)+u[S(0x159)],{'status':0x1f6});}}}};async function a0B(a,b,c){const T=a0O,{0x0:d,0x1:e}=new WebSocketPair();return e[T(0x123)](),a0G(e,b,c),new Response(null,{'status':0x65,'webSocket':d});}function a0C(a){const U=a0O;return a=a['replace'](/-/g,'+')[U(0x157)](/_/g,'/'),Uint8Array[U(0x172)](atob(a),b=>b[U(0x17b)](0x0))[U(0x169)];}async function a0D(a){const V=a0O,b=new DataView(a),c=new Uint8Array(a),d=c[0x11],f=0x12+d+0x1,g=b['getUint16'](f);if(g===0x35)throw new Error(V(0x151));const h=f+0x2;let j=c[h],k=h+0x1,l,m;switch(j){case 0x1:m=0x4,l=Array[V(0x172)](c['slice'](k,k+m))[V(0x177)]('.');break;case 0x2:m=c[k],k+=0x1;const p=new TextDecoder()[V(0x127)](c['slice'](k,k+m));l=await a0I(p);l!==p&&(j=l[V(0x168)](':')?0x3:0x1);break;case 0x3:m=0x10;const q=[],r=new DataView(a,k,0x10);for(let s=0x0;s<0x8;s++)q['push'](r['getUint16'](s*0x2)[V(0x187)](0x10));l=q[V(0x177)](':');break;default:throw new Error(V(0x16b));}const n=a['slice'](k+m);let o;if(a0o){if(a0p)o=await a0E(j,l,g);else try{o=connect({'hostname':l,'port':g}),await o[V(0x14b)];}catch(t){console[V(0x170)](V(0x179)+l+':'+g+V(0x178)+t[V(0x159)]),o=await a0E(j,l,g);}}else o=connect({'hostname':l,'port':g});return await o['opened'],{'tcpSocket':o,'初始数据':n};}async function a0E(a,b,c){const W=a0O;let d=[];a0s[W(0x133)]>0x0&&(d=[...a0s]);d[W(0x133)]===0x0&&a0q&&d[W(0x154)](a0q);if(d['length']===0x0)throw new Error(W(0x138));const e=d['map'](async(f,g)=>{const X=W;let h=null;try{const {匪号:i,密码:j,窝点:k,端口:l}=a0J(f);console[X(0x15b)](X(0x185)+(i?X(0x14a):'不带暗号')+'\x20'+k+':'+l+'\x20(探子\x20'+(g+0x1)+'/'+d[X(0x133)]+')');const m=new Promise((n,o)=>{const p=setTimeout(()=>{const Y=a0b;o(new Error(Y(0x12f)+k+':'+l));},a0v);});return h=await Promise[X(0x174)]([a0F(i,j,k,l,a,b,c),m]),console['log'](X(0x17c)+k+':'+l),{'socket':h,'config':f};}catch(n){console[X(0x170)](X(0x160)+f+'):\x20'+n[X(0x159)]);if(h)try{h[X(0x13e)]();}catch(o){console[X(0x170)](X(0x12b),o);}return Promise[X(0x16a)](new Error(X(0x13d)+f+X(0x15e)+n[X(0x159)]));}});try{const {socket:f}=await Promise[W(0x118)](e);return f;}catch(g){console['error'](W(0x121),g[W(0x132)][W(0x19b)](h=>h[W(0x159)])[W(0x177)](';\x20'));throw new Error(W(0x12d));}}async function a0F(a,b,c,d,f,g,h){const Z=a0O,k=connect({'hostname':c,'port':d});let l,m;try{await k['opened'],l=k[Z(0x137)]['getWriter'](),m=k['readable'][Z(0x163)]();const n=new TextEncoder(),o=new Uint8Array([0x5,0x2,0x0,0x2]);await l['write'](o);const p=(await m['read']())[Z(0x116)];if(!p||p[Z(0x133)]<0x2)throw new Error('SOCKS5\x20匪帮规矩回应不对。');if(p[0x1]===0x2){if(!a||!b)throw new Error(Z(0x122));const t=new Uint8Array([0x1,a[Z(0x133)],...n[Z(0x175)](a),b[Z(0x133)],...n[Z(0x175)](b)]);await l[Z(0x158)](t);const u=(await m[Z(0x17d)]())[Z(0x116)];if(!u||u[Z(0x133)]<0x2||u[0x0]!==0x1||u[0x1]!==0x0)throw new Error('SOCKS5\x20匪号/密码不对或认证失败。');}else{if(p[0x1]===0x0){}else throw new Error('不支持的\x20SOCKS5\x20匪帮规矩:\x20'+p[0x1]);}let q;switch(f){case 0x1:q=new Uint8Array([0x1,...g[Z(0x12e)]('.')['map'](Number)]);break;case 0x2:q=new Uint8Array([0x3,g[Z(0x133)],...n[Z(0x175)](g)]);break;case 0x3:const v=g[Z(0x12e)](':'),w=[];let x=![];for(let y=0x0;y<v[Z(0x133)];y++){let z=v[y];if(z===''){if(!x){let A=0x8-(v[Z(0x133)]-0x1);if(v[0x0]===''&&y===0x0)A++;if(v[v[Z(0x133)]-0x1]===''&&y===v[Z(0x133)]-0x1)A++;for(let B=0x0;B<A;B++){w[Z(0x154)](0x0,0x0);}x=!![];}}else{let C=parseInt(z,0x10);w['push'](C>>0x8&0xff,C&0xff);}}while(w['length']<0x10){w[Z(0x154)](0x0,0x0);}q=new Uint8Array([0x4,...w]);break;default:throw new Error(Z(0x183));}const r=new Uint8Array([0x5,0x1,0x0,...q,h>>0x8,h&0xff]);await l[Z(0x158)](r);const s=(await m[Z(0x17d)]())[Z(0x116)];if(!s||s[Z(0x133)]<0x2||s[0x0]!==0x5||s[0x1]!==0x0)throw new Error(Z(0x136)+g+':'+h+Z(0x134)+(s?s[0x1]:'无回应'));return l['releaseLock'](),m[Z(0x186)](),k;}catch(D){if(l)l[Z(0x186)]();if(m)m[Z(0x186)]();if(k)k[Z(0x13e)]();throw D;}}function a0a(){const aa=['lastIndexOf','释放接头管子写入锁失败:','哎呀你找到了我，但是我就是不给你看，气不气，嘿嘿嘿','value','8VJlbnf','any','SOCKS5_TXT_URL','995aeyHyU','&sni=','text','send','25dce6e6-1c37-4e8c-806b-5ef8affd9f55','addEventListener','sec-websocket-protocol','所有探子接头都失败了:','探子窝点需要暗号，但没配置。','accept','filter','then','联络\x20','decode','text/plain;charset=utf-8','成功加载\x20','\x20(状态:\x20','关闭失败的接头出错:','find','所有探子接头都失败了。','split','接头超时:\x20','174327xDqDeJ','string','errors','length',',\x20SOCKS5\x20回应码:\x20','Answer','SOCKS5\x20目标接头失败。目标:\x20','writable','没有配置探子窝点\x20(探子名单或探子窝点)。','1777644IUjoPK','text/html;\x20charset=utf-8','://','123456','探子失败:\x20','close','isArray','byteLength','SOCKS5_ADDRESS','\x20联络失败:\x20','error','catch','\x0a1、本worker的私钥功能只支持通用订阅，其他请关闭私钥功能\x0a2、其他需求自行研究\x0a通用的：https','AAAA','body','请先关闭私钥功能','indexOf','带暗号','opened','notls',':443#备用节点','探子名单未配置，跳过加载。','SOCKS5_ENABLE','cloudflare-ddns.zone.id:443#北美匪帮大寨','拒绝DNS联络','false','url','push','14412DLBUFp','水管接头已关闭。','replace','write','message','加载探子名单失败:\x20','log','<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20<head><title>欢迎光临</title></head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20<body><h1>云端响马工头已在此安寨</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>此页面为静态伪装页面（联络失败）。</p></body>\x0a\x20\x20\x20\x20\x20\x20\x20</html>','security=none','\x20-\x20','now','探子接头失败或超时\x20(','headers','pop','getReader','slice','getWriter','取消接头管子读取失败:','?name=','includes','buffer','reject','无效的目标地址类型','padStart','嘲讽语','https://dns.quad9.net/dns-query','正在加载探子名单...','warn','type','from','SOCKS5_GLOBAL','race','encode','get','join','\x20失败，尝试探子接头:\x20','直连\x20','267435INqPwl','charCodeAt','成功与探子接头:\x20','read','接头失败:\x20','\x20记录','10ShSngi','探子名单文件为空或无有效窝点。保留上次成功的名单。','json','无效的\x20SOCKS5\x20目标地址类型','https://cloudflare-dns.com/dns-query','正在尝试与探子接头:\x20','releaseLock','toString','Host','收到非二进制数据\x20(寻常路人):','\x20失败\x20(IPv4和IPv6都失败了):\x20','。将使用备用窝点（如已配置）或上次的成功名单。','&type=','security=tls','websocket','1043676xfGMci','从接头管子发送数据到寻常路人失败:','ess','my-key','来者何人!','关闭寻常路人失败:','trim','3053688KHXuOU','status','867226yenXzw','?encryption=none&','data','map','startsWith'];a0a=function(){return aa;};return a0a();}async function a0G(a,b,c){const a0=a0O;a[a0(0x11d)](new Uint8Array([0x0,0x0]));const d=b['writable'][a0(0x165)](),f=b['readable'][a0(0x163)]();c&&c[a0(0x140)]>0x0&&await d[a0(0x158)](c)[a0(0x144)](g=>console['error']('写入初始数据到接头管子失败:',g));a[a0(0x11f)](a0(0x159),async g=>{const a1=a0;if(g[a1(0x19a)]instanceof ArrayBuffer)try{await d[a1(0x158)](g[a1(0x19a)]);}catch(h){console['error']('从寻常路人写入到接头管子失败:',h);}else console['warn'](a1(0x189),g['data']);});try{while(!![]){const {value:g,done:h}=await f[a0(0x17d)]();if(h)break;if(g)try{a[a0(0x11d)](g);}catch(i){console['error'](a0(0x190),i);break;}}}catch(j){console[a0(0x143)]('从接头管子读取数据失败:',j);}finally{try{a[a0(0x13e)]();}catch(k){console[a0(0x170)](a0(0x194),k);}try{f['cancel']();}catch(l){console['warn'](a0(0x166),l);}try{d[a0(0x186)]();}catch(m){console[a0(0x170)](a0(0x19e),m);}try{b[a0(0x13e)]();}catch(n){console['warn']('关闭接头管子失败:',n);}console['log'](a0(0x156));}}function a0H(a){const a2=a0O,b=Array['from'](a,c=>c[a2(0x187)](0x10)[a2(0x16c)](0x2,'0'))['join']('');return b['slice'](0x0,0x8)+'-'+b[a2(0x164)](0x8,0xc)+'-'+b[a2(0x164)](0xc,0x10)+'-'+b[a2(0x164)](0x10,0x14)+'-'+b['slice'](0x14);}async function a0I(a){const a3=a0O,b=c=>a0w['map'](d=>fetch(d+a3(0x167)+a+a3(0x18c)+c,{'headers':{'Accept':'application/dns-json'}})[a3(0x125)](f=>f[a3(0x182)]())['then'](f=>{const a4=a3,g=f[a4(0x135)]?.[a4(0x12c)](h=>h[a4(0x171)]===(c==='A'?0x1:0x1c))?.['data'];if(g)return g;return Promise['reject']('没有\x20'+c+a4(0x17f));})['catch'](f=>Promise[a3(0x16a)](d+'\x20'+c+a3(0x142)+f)));try{return await Promise['any'](b('A'));}catch(c){try{return await Promise[a3(0x118)](b(a3(0x146)));}catch(d){return console[a3(0x170)](a3(0x126)+a+a3(0x18a)+d['message']),a;}}}function a0J(a){const a5=a0O,b=a[a5(0x19d)]('@');if(b===-0x1){const [j,k]=a0K(a);return{'匪号':'','密码':'','窝点':j,'端口':k};}const c=a[a5(0x164)](0x0,b),d=a[a5(0x164)](b+0x1),e=c['lastIndexOf'](':'),f=e>-0x1?c[a5(0x164)](0x0,e):'',g=e>-0x1?c[a5(0x164)](e+0x1):'',[h,i]=a0K(d);return{'匪号':f,'密码':g,'窝点':h,'端口':i};}function a0K(a){const a6=a0O;let b,c;if(a[a6(0x19c)]('[')){const d=a[a6(0x149)](']');if(d===-0x1)throw new Error('无效的IPv6地址格式');b=a[a6(0x164)](0x1,d);const e=a[a6(0x164)](d+0x1);c=e[a6(0x19c)](':')?Number(e[a6(0x164)](0x1)):0x1bb;if(isNaN(c)||c<=0x0||c>0xffff)c=0x1bb;}else{const f=a[a6(0x19d)](':');f>-0x1&&!isNaN(Number(a[a6(0x164)](f+0x1)))?(b=a[a6(0x164)](0x0,f),c=Number(a[a6(0x164)](f+0x1))):(b=a,c=0x1bb);}return[b,c];}function a0b(a,b){const c=a0a();return a0b=function(d,e){d=d-0x116;let f=c[d];return f;},a0b(a,b);}function a0L(a,b){const a7=a0O;return a7(0x145)+a0e+b+'/'+a+'/'+a0c+a0d+'\x0a';}function a0M(a){const a8=a0O,b=a0l[a8(0x133)]===0x0||a0l['length']===0x1&&a0l[0x0]==='',c=a0m['length']===0x0||a0m[a8(0x133)]===0x1&&a0m[0x0]==='',d=!b||!c?a0l:[a+a8(0x14d)];return a0h?a8(0x148):d[a8(0x19b)](e=>{const a9=a8,f=e[a9(0x12e)]('@');let g=f[0x0],h=a9(0x18d);if(f['length']>0x1){const n=f[0x1];n['toLowerCase']()===a9(0x14c)&&(h=a9(0x15d));}const [i,j=a0n]=g[a9(0x12e)]('#'),k=i[a9(0x12e)](':'),l=k['length']>0x1&&!isNaN(Number(k[k[a9(0x133)]-0x1]))?Number(k[a9(0x162)]()):0x1bb,m=k['join'](':');return''+a0c+a0d+a0e+a0g+'@'+m+':'+l+a9(0x199)+h+a9(0x11b)+a+'&type=ws&host='+a+'&path=%2F%3Ded%3D2560#'+j;})[a8(0x177)]('\x0a');}